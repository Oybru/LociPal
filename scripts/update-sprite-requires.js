#!/usr/bin/env node
/**
 * Auto-update spriteRequires.ts based on PNGs in src/assets/generated/items/
 *
 * Scans the items directory, generates a new spriteRequires.ts with require()
 * entries for every PNG found. Run this after generating new sprites.
 *
 * Usage:
 *   node scripts/update-sprite-requires.js
 */

const fs = require('fs');
const path = require('path');

const ROOT = path.join(__dirname, '..');
const ITEMS_DIR = path.join(ROOT, 'src', 'assets', 'generated', 'items');
const OUTPUT = path.join(ROOT, 'src', 'config', 'spriteRequires.ts');

function main() {
  if (!fs.existsSync(ITEMS_DIR)) {
    console.error(`Items directory not found: ${ITEMS_DIR}`);
    process.exit(1);
  }

  const pngs = fs.readdirSync(ITEMS_DIR)
    .filter(f => f.endsWith('.png'))
    .map(f => f.replace('.png', ''))
    .sort();

  console.log(`Found ${pngs.length} PNGs in ${ITEMS_DIR}`);

  const lines = [
    '// Sprite PNG require() map â€” auto-generated by scripts/update-sprite-requires.js',
    '// Re-run after adding new PNGs: node scripts/update-sprite-requires.js',
    '',
    'export const SPRITE_SOURCES: Record<string, any> = {',
  ];

  for (const id of pngs) {
    lines.push(`  ${id}: require('../assets/generated/items/${id}.png'),`);
  }

  lines.push('};');
  lines.push('');

  fs.writeFileSync(OUTPUT, lines.join('\n'), 'utf-8');
  console.log(`Updated ${OUTPUT}`);
  console.log(`  ${pngs.length} require() entries written`);
}

main();
